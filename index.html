<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Otimizador de Rotas - Calcule a melhor rota para atendimento aos seus clientes">
    <title>RotaFácil - Otimizador de Rotas</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- App CSS -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i data-lucide="route" class="logo-svg"></i>
                    </div>
                    <div class="logo-text">
                        <h1>RotaFácil</h1>
                        <span class="logo-subtitle">Otimizador de Rotas</span>
                    </div>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle" title="Recolher menu">
                    <i data-lucide="panel-left-close"></i>
                </button>
            </div>

            <!-- Base Location -->
            <div class="section">
                <div class="section-header">
                    <i data-lucide="building-2"></i>
                    <h2>Central (Base)</h2>
                </div>
                <div class="base-location-card">
                    <div class="base-coords">
                        <span class="coord-label">Lat:</span>
                        <input type="text" id="baseLat" value="-2.4958075418161236" class="coord-input">
                    </div>
                    <div class="base-coords">
                        <span class="coord-label">Lng:</span>
                        <input type="text" id="baseLng" value="-44.307243068708296" class="coord-input">
                    </div>
                    <button class="btn btn-secondary btn-sm" id="updateBaseBtn" title="Atualizar localização da base">
                        <i data-lucide="map-pin"></i>
                        <span>Atualizar Base</span>
                    </button>
                </div>
            </div>

            <!-- Add Client -->
            <div class="section">
                <div class="section-header">
                    <i data-lucide="user-plus"></i>
                    <h2>Adicionar Cliente</h2>
                </div>
                <div class="add-client-form">
                    <div class="form-group">
                        <label for="clientName">Nome do Cliente</label>
                        <input type="text" id="clientName" placeholder="Ex: João Silva" class="input">
                    </div>
                    <div class="form-group">
                        <label for="clientLink">Link do Google Maps</label>
                        <textarea id="clientLink" placeholder="Cole o link do Google Maps aqui..."
                            class="input textarea" rows="3"></textarea>
                    </div>
                    <div class="form-group coords-manual" id="coordsManual" style="display:none;">
                        <label>Ou insira as coordenadas manualmente</label>
                        <div class="coords-row">
                            <input type="text" id="clientLat" placeholder="Latitude" class="input">
                            <input type="text" id="clientLng" placeholder="Longitude" class="input">
                        </div>
                    </div>
                    <button class="btn-link" id="toggleManualCoords">
                        <i data-lucide="settings-2"></i>
                        <span>Inserir coordenadas manualmente</span>
                    </button>
                    <button class="btn btn-primary" id="addClientBtn">
                        <i data-lucide="plus-circle"></i>
                        <span>Adicionar Cliente</span>
                    </button>
                </div>
            </div>

            <!-- Client List -->
            <div class="section client-list-section">
                <div class="section-header">
                    <i data-lucide="users"></i>
                    <h2>Clientes (<span id="clientCount">0</span>)</h2>
                    <button class="btn-icon btn-danger-icon" id="clearAllBtn" title="Remover todos">
                        <i data-lucide="trash-2"></i>
                    </button>
                </div>
                <div class="client-list" id="clientList">
                    <div class="empty-state" id="emptyState">
                        <i data-lucide="map-pin-off"></i>
                        <p>Nenhum cliente adicionado</p>
                        <span>Cole links do Google Maps acima para começar</span>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="section section-actions">
                <button class="btn btn-accent btn-lg" id="calculateRouteBtn" disabled>
                    <i data-lucide="navigation"></i>
                    <span>Calcular Melhor Rota</span>
                </button>
                <button class="btn btn-secondary btn-lg" id="openGoogleMapsBtn" style="display:none;">
                    <i data-lucide="external-link"></i>
                    <span>Abrir no Google Maps</span>
                </button>
                <button class="btn btn-share btn-lg" id="shareRouteBtn" style="display:none;">
                    <i data-lucide="share-2"></i>
                    <span>Compartilhar Rota</span>
                </button>
            </div>
        </aside>

        <!-- Mobile Toggle -->
        <button class="mobile-sidebar-toggle" id="mobileSidebarToggle">
            <i data-lucide="menu"></i>
        </button>

        <!-- Map Area -->
        <main class="map-container">
            <div id="map"></div>

            <!-- Route Summary Overlay -->
            <div class="route-summary" id="routeSummary" style="display:none;">
                <div class="route-summary-header">
                    <h3>
                        <i data-lucide="flag"></i>
                        Resumo da Rota
                    </h3>
                    <button class="btn-icon" id="closeRouteSummary">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <div class="route-summary-body">
                    <div class="route-stat">
                        <div class="stat-icon stat-distance">
                            <i data-lucide="ruler"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Distância Total</span>
                            <span class="stat-value" id="totalDistance">0 km</span>
                        </div>
                    </div>
                    <div class="route-stat">
                        <div class="stat-icon stat-time">
                            <i data-lucide="clock"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Tempo Estimado</span>
                            <span class="stat-value" id="totalTime">0 min</span>
                        </div>
                    </div>
                    <div class="route-stat">
                        <div class="stat-icon stat-stops">
                            <i data-lucide="map-pin"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Paradas</span>
                            <span class="stat-value" id="totalStops">0</span>
                        </div>
                    </div>
                </div>
                <div class="route-order" id="routeOrder">
                    <!-- Filled dynamically -->
                </div>
            </div>

            <!-- Loading Overlay -->
            <div class="loading-overlay" id="loadingOverlay" style="display:none;">
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <p>Calculando a melhor rota...</p>
                </div>
            </div>
            <!-- Share Modal -->
            <div class="share-modal-overlay" id="shareModalOverlay" style="display:none;">
                <div class="share-modal">
                    <div class="share-modal-header">
                        <h3>
                            <i data-lucide="share-2"></i>
                            Compartilhar Rota
                        </h3>
                        <button class="btn-icon" id="closeShareModal">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                    <div class="share-modal-body">
                        <p class="share-description">Envie o link ou a mensagem abaixo para o técnico seguir a rota
                            diretamente no celular.</p>

                        <!-- Google Maps Link -->
                        <div class="share-section">
                            <label class="share-label">
                                <i data-lucide="map"></i>
                                Link do Google Maps
                            </label>
                            <div class="share-link-box">
                                <input type="text" id="shareLinkInput" class="share-link-input" readonly>
                                <button class="btn-copy" id="copyLinkBtn" title="Copiar link">
                                    <i data-lucide="copy"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Formatted Message -->
                        <div class="share-section">
                            <label class="share-label">
                                <i data-lucide="message-square"></i>
                                Mensagem Formatada
                            </label>
                            <textarea id="shareMessageText" class="share-message-textarea" readonly rows="8"></textarea>
                            <button class="btn btn-secondary btn-sm" id="copyMessageBtn">
                                <i data-lucide="clipboard"></i>
                                <span>Copiar Mensagem</span>
                            </button>
                        </div>

                        <!-- Share Buttons -->
                        <div class="share-buttons">
                            <button class="btn btn-whatsapp" id="shareWhatsAppBtn">
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                                    <path
                                        d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
                                </svg>
                                <span>Enviar via WhatsApp</span>
                            </button>
                            <button class="btn btn-secondary" id="shareNativeBtn">
                                <i data-lucide="smartphone"></i>
                                <span>Compartilhar</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- App JS -->
    <script src="app.js"></script>
</body>

</html>